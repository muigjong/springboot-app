<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>교회 점수 순위</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif; /* 나눔고딕으로 설정 */
            background-color: #f9f9f9; /* 배경색 추가 */
            margin: 0;
            padding: 20px; /* 페이지 여백 추가 */
        }

        h1 {
            text-align: center; /* 제목을 가운데 정렬 */
            color: #333; /* 제목 색상 */
            margin-bottom: 20px; /* 제목 아래 여백 */
            font-size: 2.5em; /* 제목 크기 */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); /* 제목 그림자 */
        }

        table {
            width: 80%; /* 테이블 너비 조정 */
            max-width: 600px; /* 최대 너비 설정 */
            border-collapse: collapse;
            margin: 0 auto; /* 가운데 정렬 */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* 테이블 그림자 */
            border-radius: 8px; /* 테이블 모서리 둥글게 */
            overflow: hidden; /* 모서리 둥글게 처리 */
        }

        thead tr {
            background-color: #007bff; /* 헤더 배경색 */
            color: white; /* 헤더 글자색 */
        }

        th, td {
            border: 1px solid #ddd; /* 테두리 색상 변경 */
            padding: 12px;
            text-align: center; /* 텍스트 중앙 정렬 */
            transition: background-color 0.3s; /* 배경색 전환 효과 */
        }

        th {
            font-weight: bold; /* 헤더 글자 두껍게 */
        }

        tbody tr {
            background-color: white; /* 기본 배경색 */
        }

        tbody tr:hover {
            background-color: #f1f1f1; /* 호버 시 배경색 변경 */
        }

        .th2 {
            display: none; /* th2 클래스를 가진 셀을 보이지 않게 설정 */
        }

        a {
                text-decoration: none; /* a 태그의 밑줄 제거 */
}
    </style>

</head>
<body>
<th:block th:include="layouts/header"></th:block>
<h1>교회 점수 순위</h1>
<table>
    <thead>
    <tr>
        <th>순위</th>
        <th  class="th2"></th>
        <th>교회 이름</th>
        <th>점수</th>
    </tr>
    </thead>
    <tbody id="churchScoresBody">
    <tr th:each="churchScore : ${churchScores}">
        <td class="th2"></td> <!-- 순위 번호는 JavaScript에서 추가할 것이므로 비워둡니다. -->
        <td th:text="${churchScore.churchName}"></td>
        <td th:text="${churchScore.score}"></td>
    </tr>
    </tbody>
</table>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const tbody = document.getElementById('churchScoresBody');
        const rows = Array.from(tbody.getElementsByTagName('tr'));

        // "관리자" 이름을 가진 교회를 필터링
        const filteredRows = rows.filter(row => {
            const churchName = row.cells[1].innerText; // 교회 이름이 있는 셀
            return churchName !== "관리자"; // "관리자"가 아닌 경우만 포함
        });

        // 점수를 기준으로 내림차순 정렬
        filteredRows.sort((a, b) => {
            const scoreA = parseFloat(a.cells[2].innerText); // 점수
            const scoreB = parseFloat(b.cells[2].innerText); // 점수
            return scoreB - scoreA; // 내림차순 정렬
        });

        // 필터링된 행을 tbody에 추가
        tbody.innerHTML = ''; // 기존 내용 삭제
        let currentRank = 0; // 현재 순위
        let lastScore = null; // 마지막 점수
        let sameRankCount = 0; // 같은 순위 카운트

        filteredRows.forEach((row, index) => {
            const score = parseFloat(row.cells[2].innerText); // 현재 행의 점수

            // 점수가 같으면 같은 순위를 부여
            if (score === lastScore) {
                sameRankCount++;
            } else {
                currentRank += sameRankCount + 1; // 같은 순위 수 + 1
                sameRankCount = 0; // 같은 순위 카운트 초기화
                lastScore = score; // 마지막 점수 업데이트
            }

            const rankCell = document.createElement('td');
            rankCell.innerText = currentRank; // 순위 번호 추가
            row.insertBefore(rankCell, row.firstChild); // 순위 번호를 맨 앞에 추가
            tbody.appendChild(row); // 행 추가
        });
    });
</script>


</body>
</html>
